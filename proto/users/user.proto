syntax = "proto3";
package users;

import "common/common.proto";
import "healthcheck/healthcheck.proto";
service UserService {
    rpc HealthCheck(common.Empty) returns (grpc.health.v1.HealthCheckResponse);
    rpc CreateUser(UserRequest) returns (common.Response);
    rpc CheckUserExists(CheckUserRequest) returns (common.Response);
    rpc VerifyUser(VerifyRequest) returns (common.Response);
    rpc SendTokenVerification(SendTokenRequest) returns (common.Response);
    rpc Login(LoginRequest) returns (UserResponse);
    rpc GetUser(common.GetRequest) returns (UserResponse);
    rpc GetUsers(common.GetRequest) returns (UserResponse);
    rpc UserOAuthProvider(CustomerOAuthProviderRequest) returns (UserResponse);
    rpc ChangePassword(ChangePasswordRequest) returns (common.Response);
    rpc UpdateSettings(UpdateSettingsRequest) returns (common.Response);
    rpc SaveBankAccount(SaveBankAccountRequest) returns (common.Response);
    rpc GetBankAccounts(common.GetRequest) returns (common.ListResponse);
    rpc GetBankAccount(common.GetRequest) returns (common.Response);
    rpc ResetPasswordVerification(ResetPasswordRequest) returns (common.Response);
    rpc DeleteUser(common.IdRequest) returns (common.Response);
    rpc ApproveUser(common.IdRequest) returns (common.Response);
    rpc RejectUser(common.IdRequest) returns (common.Response);
    rpc ActivateUser(common.IdRequest) returns (common.Response);
    rpc DeactivateUser(common.IdRequest) returns (common.Response);
    //Customers

    rpc SaveCategory(SaveCategoryRequest) returns (common.Response);
    rpc GetCategory(common.GetRequest) returns (common.Response);
    rpc GetCategories(common.GetRequest) returns (common.ListResponse);
    rpc DeleteCategory(common.GetRequest) returns (common.Response);
    
}
message AddressList {
    repeated Address data = 1;
    int32 status = 4;
    bool success = 2;
    string message = 3;

}

message GetListRequest {
    string query = 1;
    map<string, string > filters = 2;
    int32 page = 3;
    int32 size = 4;
    optional string user_id = 5;
}

message SaveCategoryRequest {
    optional string id = 1;
    string user_id = 2;
    string name = 3;
    map<string, string> metadata = 4;
}
enum OTPType {
    OTP_TYPE_UNSPECIFIED = 0;
    RESET_PASSWORD = 1;
    CONFIRM_NEW_DEVICE = 2;
    EMAIL_VERIFICATION = 3;
    TRANSACTION_PIN = 4;
    PHONE_VERIFICATION = 7; // use for just verifying phone number
    EMAIL_CONFIRMATION =6;
}

message ResetPasswordRequest {
    string user = 1;
    string otp = 2;
    string password = 3;
}
//User Requests
message CustomerOAuthProviderRequest {
    string provider = 1;
    string token = 2;
    string device_token = 3;
    string medium = 4;
    float latitude = 5;
    float longitude = 6;
    map<string, string> address = 7;
}
message CheckUserRequest {
    string with = 1;
    string user = 2;
}
message SendTokenRequest {
    optional string id = 1;
    string with = 2; // 'email' or 'phone'
    string user = 3; // email address or phone number
    UserType user_type = 4;
    OTPType type = 5;
}
message VerifyRequest {
    string with = 1; // 'email' or 'phone'
    string user = 2; // email address or phone number
    string token = 3;
}

message UpdateSettingsRequest {
    string user_id = 1;
    map<string, string> settings = 2;
}
message ChangePasswordRequest {
    string user_id = 1;
    string old_password = 2;
    string new_password = 3;
    optional string email = 4;
}
message SaveBankAccountRequest {
    string user_id = 1;
    string account_name = 2;
    string account_number = 3;
    string bank_name = 4;
    string bank_code = 5;
    bool is_main = 6;
    optional bool status = 7;
    optional string id = 8;
}
message UserResponse {
    int32 status = 1;
    bool success = 2;
    string message = 3;
    optional string error = 4;
    message Data {
        User user = 1;
        optional Customer customer = 2;
        Wallet wallet = 3;
        map<string, string > settings = 4;
        optional Rider rider = 5;
        optional Seller seller = 6;
        optional Personnel personnel = 7;
        Address address = 8;
    }
    Data data = 5;
}
//
//Data
message BankAccount {
    string user_id = 1;
    string account_name = 2;
    string account_numner = 3;
    bool is_main = 4;
    string bank_name = 5;
    string bank_code = 6;
    bool status = 7;
}
message User {
    string id = 1;
    string latitude = 5;
    string longitude = 6;
    string device_version = 7;
    string compliance_status = 8;
}

message Wallet {
    string id = 1;
    string accountName = 2;
    string accountNumber =3;
    double balance = 4;
}

//Requests
message UserRequest {
    string name = 1;
    string email = 2;
    string password = 3;
    string phone = 4;
}
message Address {
    optional string id = 1;
    float latitude = 2;
    float longitude = 3;
    string formated_address = 4;
}
message SaveCustomerRequest {

    optional string id = 1;
    string email = 2;
    string password = 3;
    string phone = 4;
    string firstname = 5;
    string lastname = 6;
    Address address = 7;
    string deviceToken = 8;
    string deviceVersion = 9;
    string referral = 10;
}

enum UserType {
    USER_TYPE_UNSPECIFIED = 0;
    USER_TYPE_CUSTOMER = 1;
    USER_TYPE_RIDER = 2;
    USER_TYPE_VENDOR = 3;
    USER_TYPE_ADMIN = 4;
}
message LoginRequest {
    string username = 1;
    string password = 2;
    string device_version = 3;
    string device_token = 4;
    string device_type = 6;
}

message Device {
    string device = 1;
    string type = 2;
}
message Customer {
    string id = 1;
    string username = 2;
    string email = 3;
    string phone = 4;
    string firstname = 5;
    string lastname = 6;
    map<string, string> phones = 7;
    string referral_code = 8;
    string avatar = 9;
    string created_at = 10;
    string updated_at = 11;
    repeated Device devices = 12;
}

message Rider {
    string id = 1;
    map<string, string> phones = 2;
    string firstname = 4;
    string lastname = 5;
    optional users.Address address = 6;
    repeated Device devices = 7;
    int32 contract_type = 8;
    repeated int32 shift_data = 9;
    optional string next_of_kin = 10;
    optional string next_of_kin_phone_number = 11;
    optional string drivers_license = 12;
    optional int32 vehicle_type = 13;
    optional string vehicle_brand = 14;
    optional string vehicle_plate_number = 15;
    optional string vehicle_picture = 16;
    optional string first_guarantor_name = 17;
    optional string first_guarantor_phone_number = 18;
    optional string second_guarantor_name = 19;
    optional string second_guarantor_phone_number = 20;
    optional string previous_place_of_work = 21;
    optional string previous_place_of_work_duration = 22;
    optional string bank_name = 23;
    optional string bank_code = 24;
    optional string account_number = 25;
    optional string account_name = 26;
    optional string selfie = 27;
    string created_at = 28;
    string updated_at = 29;
}

message Seller {
    string id = 1;
    string status = 2;
    optional string plan = 3;
    optional int32 tier = 4;
    string email = 5;
    repeated string phones = 6;
    string user_id = 7;
    Address address = 8;
    string category_id = 10;
    string business_name = 11;
    optional string individual_full_name = 15;
    string individual_address = 16;
    optional string individual_selfie = 17;
    optional string individual_identity_card = 18;
    optional string business_email = 20;
    string license_number = 21;
    string opening_hours = 22;
    string closing_hours = 23;
    optional string business_logo = 27;
    optional string business_thumbnail = 28;
    optional string business_certificate = 29;
    optional string business_memorandum = 30;
    optional string business_utility_bill = 31;
    optional string business_building = 32;
    repeated Device devices = 33;
    string created_at = 34;
    string updated_at = 35;
}

message Personnel {
    string id = 1;
    string firstname = 2;
    string lastname = 3;
    string othername = 4;
    string user_id = 5;
    string business_id = 6;
    string avatar = 7;
    string compliance = 8;
    string status = 9;
    string created_at = 10;
    repeated Device devices = 33;
}
